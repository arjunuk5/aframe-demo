<html>
   <!-- include A-Frame obviously -->
   <!-- <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script> -->
   <!-- include ar.js for A-Frame -->
   <!-- <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script> -->
   <!-- <script src="http://supereggbert.github.io/aframe-htmlembed-component/dist/build.js"></script> -->
   <script src="resources/scripts/aframe-v1.4.1.min.js"></script>
   <script src="resources/scripts/aframe-ar.js"></script>
   <script src="resources/scripts/aframe-htmlembed-component.js"></script>
   <script>
      AFRAME.registerComponent("markerhandler", {
         init: function () {
            this.el.sceneEl.addEventListener("markerFound", () => {
               let markerId = this.el?.id;
               //console.log(markerId);

               const marker = document.querySelector("#" + markerId);

               var tempEl = document.createElement("a-entity");
               tempEl.setAttribute("position", "0 .4 0");
               tempEl.setAttribute("rotation", "-20 0 0");
               tempEl.setAttribute(
                  "animation",
                  "property: scale; to: 2 2 2; dir: alternate; loop: true"
               );

               var humEl = document.createElement("a-entity");
               humEl.setAttribute("position", "0 .2 0");
               humEl.setAttribute("rotation", "-20 0 0");
               humEl.setAttribute(
                  "animation",
                  "property: scale; to: 2 2 2; dir: alternate; loop: true"
               );

               var statusEl = document.createElement("a-entity");
               statusEl.setAttribute("position", "0 .6 0");
               statusEl.setAttribute("rotation", "-20 0 0");
               statusEl.setAttribute(
                  "animation",
                  "property: scale; to: 2 2 2; dir: alternate; loop: true"
               );

               let apiURL = "http://182.72.154.142:1881/iotapi/sensor-details?id=";
               apiURL += markerId;

               fetch(apiURL)
                  .then((response) => response.json())
                  .then((data) => {
                     // let html = `<h3>${data.name}</h3>`;
                     // html += `<ul><li>Temperature: ${data.temp}</li><li>Humidity: ${data.hum}</li><li>Status: ${data.status}</li></ul>`;
                     // let divId = "dv-" + markerId;
                     marker.innerHTML = "";
                     tempEl.setAttribute(
                        "text",
                        `color: red; align: center; value: Temperature - ${data.temp}; width: 1.5`
                     );
                     marker.appendChild(tempEl);

                     humEl.setAttribute(
                        "text",
                        `color: yellow; align: center; value: Humidity - ${data.hum}; width: 1.5`
                     );
                     marker.appendChild(humEl);

                     statusEl.setAttribute(
                        "text",
                        `color: blue; align: center; value: Status - ${data.status}; width: 1.5`
                     );
                     marker.appendChild(statusEl);
                  })
                  .catch((error) => {
                     marker.innerHTML = "";
                     tempEl.setAttribute(
                        "text",
                        `color: red; align: center; value: Temperature - Not available; width: 1.5`
                     );
                     marker.appendChild(tempEl);

                     humEl.setAttribute(
                        "text",
                        `color: yellow; align: center; value: Humidity - Not available; width: 1.5`
                     );
                     marker.appendChild(humEl);

                     statusEl.setAttribute(
                        "text",
                        `color: blue; align: center; value: Status - Not available; width: 1.5`
                     );
                     marker.appendChild(statusEl);
                  });
            });
         },
      });
   </script>
   <body style="margin: 0px; overflow: hidden">
      <a-scene embedded arjs>
         <a-marker markerhandler preset="kanji" id="sensor-st"> </a-marker>
         <a-entity camera></a-entity>
      </a-scene>
   </body>
</html>
